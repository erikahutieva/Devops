Part 1. Инструмент **ipcalc**

1. Сети и маски

\1) Адрес сети 192\.167\.38\.54/13 :

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.001.jpeg)

\2)

255\.255.255.0 в префиксную и двоичную запись: Префиксная запись: /24

Двоичная запись: 11111111.11111111.11111111.00000000

/15 в обычную и двоичную запись:

Обычная запись: 255.254.0.0

Двоичная запись: 11111111.11111110.00000000.00000000

11111111\.11111111.11111111.11110000 в обычную и префиксную запись: Обычная запись: 255.255.255.240

Префиксная запись: /28

3) Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.002.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.003.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.004.jpeg)

2. localhost

Адреса localhost находятся в диапазоне 127.0.0.0/8, то есть от 127.0.0.0 до 127.255.255.255.

194\.34.23.100: Нет

127\.0.0.2: Да

127\.1.0.1: Да

128\.0.0.1: Нет

3. Диапазоны и сегменты сетей

\1) Частные:

10\.0.0.0 - 10.255.255.255 (10.0.0.0/8) 172.16.0.0 - 172.31.255.255 (172.16.0.0/12) 192.168.0.0 - 192.168.255.255 (192.168.0.0/16) Остальные публичные

10\.0.0.45 - частный

134\.43.0.2 - публичный

192\.168.4.2 - частный

172\.20.250.4 -частный

172\.0.2.1 - частный

192\.172.0.1 - публичный

172\.68.0.2 - частный

172\.16.255.255 - частный 10.10.10.10 - частный 192.169.168.1 - публичный

\2)

Минимальный хост: 10.10.0.1

Максимальный хост: 10.10.63.254

Возможные: 10.10.0.2, 10.10.10.10, 10.10.1.255, 10.10.0.0/18. Невозможные: 10.0.0.1, 10.10.100.1

Part 2. Статическая маршрутизация между двумя машинами.

С помощью команды ip a посмотр существующих сетевых интерфейсов.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.005.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.006.jpeg)

Опиши сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - *192.168.100.10*, маска */16*, ws2 - *172.24.116.8*, маска */12*.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.007.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.008.jpeg)

Команда netplan apply для перезапуска сервиса сети.

1. Добавление статического маршрута вручную

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.009.jpeg)

2. Добавление статического маршрута с сохранением

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.010.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.011.jpeg)

Part 3. Утилита **iperf3**

1. **Скорость соединения**

8 Mbps=1 MB/s

100 MB/s=100×8×1024 Kbps=819200 Kbps 1 Gbps=1024 Mbps

2. Утилита iperf3

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.012.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.013.jpeg)

Part 4. Сетевой экран

1. Утилита iptables

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.014.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.015.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.016.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.017.png)

2. Утилита nmap

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.018.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.019.png)

Part 5. Статическая маршрутизация сети

1. Настройка адресов машин

w11:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.020.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.021.png)

w21:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.022.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.023.png)

w22:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.024.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.025.png)

r1:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.026.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.027.png)

r2:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.028.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.029.png)

пропингуй ws22 с ws21. Аналогично пропингуй r1 с ws11.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.030.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.031.png)

2. Включение переадресации IP-адресов

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.032.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.033.png)-

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.034.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.035.jpeg)

3. Установка маршрута по-умолчанию w11:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.036.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.037.png)

w21:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.038.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.039.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.040.png)

w22:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.041.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.042.png)

w11 c r2:

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.043.jpeg)

4. Добавление статических маршрутов

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.044.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.045.jpeg)

Вызвать ip r и показать таблицы с маршрутами на обоих роутерах.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.046.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.047.png)

Запусти команды на ws11:

ip r list 10.10.0.0/[маска сети] и ip r list 0.0.0.0/0

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.048.png)

Маршрут подбирается по таблице марштрутизаторов. Если маршрут выбран успешно то он будет передан. Если не успешно - пакет не будет передан. Если несколько совпадений - то для переадсресации будет выбран маршрут с самой длинной маской.

5. Построение списка маршрутизаторов

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.049.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.050.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.051.jpeg)

6. Использование протокола ICMP при маршрутизации

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.052.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.053.png)

Part 6. Динамическая настройка IP с помощью **DHCP**

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.054.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.055.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.056.png)

Машину ws21 перезагрузить при помощи reboot и через ip a показать, что она получила адрес. Также пропинговать ws22 с ws21.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.057.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.058.png)

Укажи MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.059.png)

Для r1 настрой аналогично r2, но сделай выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Проведи аналогичные тесты.

ip до обновления и после.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.060.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.061.jpeg)

Запроси с ws21 обновление ip адреса.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.062.jpeg)

Пинг с обновленным ip у машины ws21

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.063.png)

Part 7. **NAT**

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.064.jpeg)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.065.jpeg)

Добавить в фаервол, на r2 следующие правила:

Удаление правил в таблице filter - iptables -F

Удаление правил в таблице "NAT" - iptables -F -t nat

Отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.066.png)

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.067.png)

Проверь соединение между ws22 и r1 командой ping.

*При запуске файла с этими правилами, ws22 не должна «пинговаться» с r1.*

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.068.png)

4) Разрешить маршрутизацию всех пакетов протокола ICMP.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.069.jpeg)

Проверь соединение между ws22 и r1 командой ping.

При запуске файла с этими правилами, ws22 должна «пинговаться» с r1.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.070.jpeg)

5) Включи SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2
5) Включи DNAT на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети.

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.071.jpeg)

Проверь соединение по TCP для SNAT: для этого с ws22 подключиться к серверу

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.072.png)

Проверь соединение по TCP для DNAT: для этого с r1 подключиться к серверу Apache на ws22 командой telnet (обращаться по адресу r2 и порту 8080).

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.073.png)

Part 8. Дополнительно. Знакомство с SSH Tunnels

Запусти веб-сервер **Apache** на ws22 только на localhost (то есть в файле */etc/apache2/ports.conf* измени строку Listen 80 на Listen localhost:80).

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.074.png)

Воспользоваться *Local TCP forwarding* с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21 Воспользоваться *Remote TCP forwarding* c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11

![](Aspose.Words.545a2e5c-b790-42ab-bbf2-6b5710f8b402.075.png)
